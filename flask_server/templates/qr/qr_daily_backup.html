<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Echarts</title>
    <script src="/static/echarts.common.js"></script>
    <script src="/static/jquery-3.4.1.min.js"></script>
    <!-- <script src="/static/assets/scripts/jquery.ba-resize.js"></script> -->
    <style>
        div{ text-align: center; margin:0 auto; } 
    </style>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="qr_total" style="width: 80%;height:400px;"></div>
    <div id="qr_product" style="width: 80%;height:400px;"></div>
    
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var qr_total = echarts.init(document.getElementById('qr_total'));
        var ranges = 7; 
        // 指定图表的配置项和数据
        var option = {
            title: {
                text: '二维码每日的总体交易情况', 
                subtext: '万笔 / 万元'
            },
            tooltip: { trigger: 'axis'},
            grid: { left: '5%', right: '10%', 
                    bottom: '10%', containLabel: true
            }, 
            toolbox: { feature: { 
                            saveAsImage: {}, 
                            dataZoom: { yAxisIndex: 'none' }, 
                            dataView: { readOnly: false }, 
                            magicType: { type: ['line', 'bar'] }, 
                            restore: {}, 
                            saveAsImage: {}
                       }, 
                       orient: 'vertical', 
                       top: 'middle', 
                       right: '3%' 
            }, 
            legend: { left: 'center', top: '7%', 
                data:['交易笔数', '优惠笔数', '优惠金额'] 
            },
            xAxis: { type: 'category', boundaryGap: false, data: [] },
            yAxis: { type: 'value' },
            series: [
                { 
                    name: '交易笔数', type: 'line', data: [], 
                    // label: { normal: {show: true} } 
                }, 
                { 
                    name: '优惠笔数', type: 'line', data: [], 
                    // label: { normal: {show: true} }
                }, 
                { 
                    name: '优惠金额', type: 'line', data: [],
                    // label: { normal: {show: true} }
                }
            ], 
            dataZoom: [
                { type: 'slider', show: true, 
                  height: '4%', bottom: '5%', 
                   filterMode: 'weakFilter', 
                  handleIcon: 'M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z', 
                  handleSize: '80%'
                }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        qr_total.setOption(option);
        
        $.ajax({
            url: '/qr/total', 
            type: 'get', 
            async: true, 
            dataType: 'json', 
            success: function (data) {
                // alert(data);
                var length = data['date'].length; 
                qr_total.setOption({
                    xAxis: { data: data['date'] }, 
                    series: [
                    {   
                        name: '交易笔数', data: data['trans_num'], 
                        markPoint: { 
                            data: [{
                                name:'昨日交易量', value: Math.round( data['trans_num'][ length - 1 ] ),  
                                coord: [ data['date'][ length - 1], data['trans_num'][ length - 1 ] ]
                            }] 
                        }
                    }, 
                    {   name: '优惠笔数', data: data['coupon_num'], 
                        markPoint: { 
                            data: [{ 
                                name: '昨日优惠笔数', value: Math.round( data['coupon_num'][ length - 1 ] ), 
                                coord: [ data['date'][ length-1 ], data['coupon_num'][ length - 1 ] ]
                            }]
                        }
                    },
                    {   name: '优惠金额', data: data['coupon_at'], 
                        markPoint: {
                            data: [{ 
                                name: '昨日优惠金额', value: Math.round( data['coupon_at'][ length - 1 ] ), 
                                coord: [ data['date'][ length-1 ], data['coupon_at'][ length - 1 ] ]
                            }]
                        }
                    }], 
                    dataZoom: [{ startValue: length - ranges, endValue: length }]
                });
            }, 
            error: function(e) {
                alert("请求数据失败!");
            }
        });



        // 基于准备好的dom，初始化echarts实例
        var qr_product = echarts.init(document.getElementById('qr_product'));
        // 指定图表的配置项和数据
        option = {
            title: {
                text: '二维码每日的各产品的交易情况', 
                subtext: '万笔'
            },
            tooltip: { trigger: 'axis'},
            grid: { left: '5%', right: '10%', 
                    bottom: '10%', containLabel: true
            }, 
            toolbox: { feature: { 
                            saveAsImage: {}, 
                            dataZoom: { yAxisIndex: 'none' }, 
                            dataView: { readOnly: false }, 
                            magicType: { type: ['line', 'bar'] }, 
                            restore: {}, 
                            saveAsImage: {}
                       }, 
                       orient: 'vertical', 
                       top: 'middle', 
                       right: '3%' 
            }, 
            legend: { left: 'center', top: '7%', 
                data:['被扫', '主扫', '扫码转账', '远程转账', '快速收款码'] 
            },
            xAxis: { type: 'category', boundaryGap: false, data: [] },
            yAxis: { type: 'value' },
            series: [
                { name: '被扫', type: 'line', data: [] }, 
                { name: '主扫', type: 'line', data: [] }, 
                { name: '扫码转账',  type: 'line', data: [] },
                { name: '远程转账', type: 'line', data: [] }, 
                { name: '快速收款码', type: 'line', data: [] }

            ], 
            dataZoom: [
                { type: 'slider', show: true, 
                  height: '4%', bottom: '5%', 
                  filterMode: 'weakFilter', 
                  handleIcon: 'M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z', 
                  handleSize: '80%'
                }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        qr_product.setOption(option);
        
        $.ajax({
            url: '/qr/product', 
            type: 'get', 
            async: true, 
            dataType: 'json', 
            success: function (data) {
                // alert(data);
                qr_product.setOption({
                    xAxis: { data: data['date'] }, 
                    series: [
                        { name: '被扫', data: data['0135'] }, 
                        { name: '主扫', data: data['0210'] },
                        { name: '人到人转账', data: data['0231'] }, 
                        { name: '远程转账', data: data['0232'] }, 
                        { name: '快速收款码', data: data['0215'] }
                    ], 
                    dataZoom: [{ startValue: data['date'].length - ranges, 
                                 endValue: data['date'].length
                    }]
                });
            }, 
            error: function(e) {
                alert("请求数据失败!");
            }
        });

    </script>
    
</body>
</html>
